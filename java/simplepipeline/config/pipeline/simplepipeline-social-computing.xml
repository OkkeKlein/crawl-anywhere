<?xml version="1.0" encoding="utf-8"?>
<pipeline>
	<param name="witnessfilespath">/opt/social-computing/log</param>
	<param name="logfilename">/opt/social-computing/log/pipeline.log</param>
	<param name="oncemodetimeout">300</param>
	<connector classname="fr.eolya.simplepipeline.connector.FileQueueConnector">
		<param name="rootdir">/opt/social-computing/queue</param>
		<param name="filepattern">^j[.].*[.]xml$</param>
		<param name="onsuccessmoveto">/opt/social-computing/queue/_success</param>
		<param name="onerrormoveto">/opt/social-computing/queue/_error</param>
	</connector>
	<stages>
		<stage position="0" enabled="no" classname="fr.eolya.simplepipeline.stage.FileQueueCleanUp">
			<param name="source_file">content_file</param>
			<param name="onsuccessmoveto">/opt/social-computing/queue/_success</param>
			<param name="onerrormoveto">/opt/social-computing/queue/_error</param>
		</stage>
		<stage position="1" classname="fr.eolya.simplepipeline.stage.DocTextExtractor">
			<param name="onaction">add</param>
			<param name="scriptspath">/opt/social-computing/config/scripts/pipeline</param>
 			<param name="url">item_url</param>
			<param name="contenttype">item_contenttype</param>
			<param name="cleanmethod">item_clean_method</param>
			<param name="cleanmethoddefault"></param>
			<param name="charset">item_charset</param>
			<param name="source">content</param>
			<param name="source_file">content_file</param>
			<param name="target">text</param>
			<param name="prefix">parser_</param>
 			<param name="pdftotextpath">/usr/bin/pdftotext</param>
 			<param name="catdocpath">/opt/local/bin/catdoc</param>
			<param name="swf2htmlpath">/usr/bin/swf2thml</param>
 			<param name="onsuccessmoveto">/opt/social-computing/queue/_success</param>
			<param name="onerrormoveto">/opt/social-computing/queue/_error</param>
 			<param name="tmppath">/opt/social-computing/tmp</param>
 			<param name="stoppipelineonerror">yes</param>
 			<param name="stoppipelineonemptytext">no</param>
		</stage>
		<stage position="2" classname="fr.eolya.simplepipeline.stage.DocSummaryExtractor">
			<param name="onaction">add</param>
			<param name="source">text</param>
			<param name="target">summary</param>
			<param name="maxsize">400</param>
		</stage>		
		<stage position="3" classname="fr.eolya.simplepipeline.stage.FieldCopy">
			<param name="onaction">add</param>
			<param name="source">item_url</param>
			<param name="sourcecapture">^(http|https):\/\/(.*?)\/</param>
  			<param name="groupcapture">2</param>
 			<param name="target">item_domain</param>
			<param name="lowercasenormalization">yes</param>
		</stage>		 
		<stage position="4" classname="fr.eolya.simplepipeline.stage.FieldMapping">
			<param name="onaction">add</param>
			<param name="source">item_contenttype</param>
			<param name="sourcecapture">^([a-zA-Z_\/\-\.\+]*).*</param>
 			<param name="target">item_contenttyperoot</param>
			<param name="mappingdefinitionfile">/opt/social-computing/config/contenttypemapping.txt</param>
			<param name="lowercasenormalization">no</param>
			<param name="sourcecaptureisdefault">yes</param>
		</stage>
		<stage position="6" classname="fr.eolya.simplepipeline.stage.LanguageDetector">
			<param name="onaction">add</param>
			<param name="text">text</param>
			<param name="target">item_language</param>
			<param name="targetdetection">item_languagedetection</param>
			<param name="declaredlanguage">source_language</param>
			<param name="candidatelanguages">source_candidatelanguages</param>
			<param name="declaredcharset">item_charset</param>
			<param name="textdetectionlength">4096</param>
			<param name="defaultlanguage">en</param>
			<param name="languagerecognizerpoolsize">5</param>
			<param name="npg">/opt/social-computing/config/ngp/ngp</param>
		</stage>
		<stage position="7" classname="fr.eolya.simplepipeline.stage.SolrIndexerQueueWriter">
			<param name="queuedir">/opt/social-computing/queue_liferay</param>
			<param name="maxqueuesize">20000</param>
			<param name="tempfilenameprefix">t.</param>
			<param name="filenameprefix">j.</param>
			<param name="solrmappings">/opt/social-computing/config/solrmapping-liferay.xml</param>
		</stage>
		<stage position="8" classname="fr.eolya.simplepipeline.stage.SolrIndexerQueueWriter">
			<param name="queuedir">/opt/social-computing/queue_solr</param>
			<param name="maxqueuesize">20000</param>
			<param name="tempfilenameprefix">t.</param>
			<param name="filenameprefix">j.</param>
			<param name="solrmappings">/opt/social-computing/config/solrmapping2.xml</param>
		</stage>
	</stages>
</pipeline>