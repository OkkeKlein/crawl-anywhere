<?xml version="1.0" encoding="utf-8"?>
<pipeline>
	<param name="witnessfilespath">/opt/crawler/log</param>
	<param name="logfilename">/opt/crawler/log/pipeline.log</param>
	<param name="oncemodetimeout">300</param>
	<connector classname="fr.eolya.simplepipeline.connector.FileQueueConnector">
		<param name="threads">1</param>
		<param name="rootdir">/opt/crawler/queue</param>
		<param name="filepattern">^j[.].*[.]xml$</param>
		<param name="onsuccessmoveto">/opt/crawler/queue/_success/{//source_id}</param>
		<param name="onerrormoveto">/opt/crawler/queue/_error/{//source_id}</param>
	</connector>
	<stages>
		<!--
		<stage classname="fr.eolya.simplepipeline.stage.BpiDb">
			<param name="jdbcdriver">org.postgresql.Driver</param>
			<param name="jdbcurl">jdbc:postgresql://$DBHOST$:$DBPORT$/$DBNAME$</param>
		 	<param name="dbhost">localhost</param>
			<param name="dbport">3306</param>
			<param name="dbname">crawler</param>
			<param name="dbuser">crawler</param>
		 	<param name="dbpassword">crawler</param>
		 	<param name="dbquery">select label from theme where id = '$CRIT$'</param>
			<param name="source">source_tags</param>
			<param name="sourcecapture">bpi_theme:"(.*)"</param>
			<param name="groupcapture">1</param>
			<param name="target">bpi_theme</param>
		</stage>
		-->
		<stage classname="fr.eolya.simplepipeline.stage.BpiDb">
			<param name="jdbcdriver">com.mysql.jdbc.Driver</param>
			<param name="jdbcurl">jdbc:mysql://$DBHOST$:$DBPORT$/$DBNAME$?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true</param>
		 	<param name="dbhost">10.1.2.113</param>
			<param name="dbport">3306</param>
			<param name="dbname">lf_prod</param>
			<param name="dbuser">crawler</param>
		 	<param name="dbpassword">crawler</param>
		 	<param name="dbquery">select label, parent from themes where reference = '$CRIT$'</param>
			<param name="source">source_tags</param>
			<param name="sourcecapture">bpi_theme:"([^"]*)"</param>
			<param name="groupcapture">1</param>
			<param name="target">bpi_theme</param>
			<param name="hierarchical">parent</param>
			<param name="hierarchical_direction">parent</param>
			<param name="hierarchical_sep"> &gt; </param>
		</stage>
		<stage position="0" classname="fr.eolya.simplepipeline.stage.BpiCleanUp">
			<param name="source">source_tags</param>
			<param name="cleanuppattern">(.*):"([^"]*)"</param>
		</stage>		
		<stage classname="fr.eolya.simplepipeline.stage.StandardQueueWriter">
			<param name="queuedir">/opt/crawler/queue_bpi/</param>
			<param name="tempfilenameprefix">t.</param>
			<param name="filenameprefix">j.</param>
		</stage>
	</stages>
</pipeline>